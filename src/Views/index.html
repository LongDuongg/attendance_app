<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style/style.css') }}"
    />

    <script
      type="text/javascript"
      src="//code.jquery.com/jquery-3.7.1.min.js"
    ></script>
    <script
      type="text/javascript"
      src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.5/socket.io.min.js"
    ></script>

    <script>
      let socket;
      $(document).ready(function () {
        socket = io.connect("http://" + document.domain + ":" + location.port);

        const interval = setInterval(() => {
          socket.emit("request_attendance_list");
        }, 1000);

        const renderCard = (student) => {
          return `
            <div class="card">
            <div class="time">
              <span>
                ${student.time}
              </span>
            </div>
            <div class="info">
              <b>${student.name}</b> <i>(${student.id})</i>
              <br />
              <br />
              <b style="background-color: #28a745">${student.class}</b>
              <br />
              <br />
              <b style="background-color: #08b7cf">${student.address}</b>
            </div>
            <img
              src="static/${student.image}"
              alt=""
              class="img-student"
            />
          </div>
          `;
        };

        socket.on("return_attendance_list", function (data) {
          const attendanceList = JSON.parse(data["data"]);
          console.log(attendanceList);

          const renderedHtml = attendanceList
            .map((student) => renderCard(student))
            .join();

          const listEL = document.getElementsByClassName("student-list")?.[0];
          const countEL = document.getElementsByClassName("list-count")?.[0];

          if (listEL) {
            listEL.innerHTML = renderedHtml;
          }

          if (countEL) {
            countEL.innerHTML = attendanceList?.length || 0;
          }
        });
      });
    </script>

    <title>Document</title>
  </head>
  <body>
    <div class="page-content">
      <div class="content-left">
        <h2>Hệ thống điểm danh sinh viên</h2>
        <img
          src="{{url_for('video_stream_controller.video')}}"
          alt=""
          class="cameraview"
        />
      </div>
      <div class="content-right">
        <h2>Danh sách sinh viên: <span class="list-count">0</span></h2>
        <div class="student-list">
          <!-- {% for item in data %}
          <div class="card">
            <div class="time">
              <span>
                Ngày 02 tháng 01 năm 2024
                <br />
                <br />
                14:10
              </span>
            </div>
            <div class="info">
              <b>{{item.name}}</b> <i>({{item.id}})</i>
              <br />
              <br />
              <b style="background-color: #28a745">19TCLC_DT1</b>
              <br />
              <br />
              <b style="background-color: #08b7cf">{{item.address}}</b>
            </div>
            <img
              src="{{ url_for('static', filename=item.image) }}"
              alt=""
              class="img-student"
            />
          </div>
          {% endfor %} -->
        </div>
      </div>
    </div>
  </body>
</html>
